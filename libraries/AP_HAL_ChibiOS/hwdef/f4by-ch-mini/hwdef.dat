# hw definition file for processing by chibios_pins.py
# for F4BY MINI board with F405 CPU
MCU STM32F4xx STM32F405xx
RAM_SIZE_KB 128
CCM_RAM_SIZE_KB 64
#use auto calculation stack size for interrupt by os
define PORT_INT_REQUIRED_STACK 0

# board ID for firmware load.  must to correspond with bootloader ID
APJ_BOARD_ID 21 
define CONFIG_HAL_BOARD_SUBTYPE HAL_BOARD_SUBTYPE_CHIBIOS_F4BY_MINI

# crystal frequency
OSCILLATOR_HZ 8000000
FLASH_SIZE_KB 1024
STM32_PLLM_VALUE 8

define STM32_ST_USE_TIMER 5
# board voltage
STM32_VDD 330U

PA13 JTMS-SWDIO SWD
PA14 JTCK-SWCLK SWD

PA11 OTG_FS_DM OTG1
PA12 OTG_FS_DP OTG1
PA9 VBUS INPUT

define HAL_STORAGE_SIZE 16384
# todo enable RAMTROM parameter storage and remove HAL_USE_EMPTY_STORAGE after tests
# define HAL_WITH_RAMTRON 1
define HAL_USE_EMPTY_STORAGE 1

# space to reserve for bootloader and storage at start of flash
FLASH_RESERVE_START_KB 16
# space to reserve for storage at end of flash
# FLASH_RESERVE_END_KB 0



# serial port for stdout
STDOUT_SERIAL SD3
STDOUT_BAUDRATE 57600

# order of UARTs (and USB)
UART_ORDER OTG1 UART5 UART4 USART1 USART3 

# UART4 telemertry
PA0 UART4_TX UART4
PA1 UART4_RX UART4

# UART5 GPS
PC12 UART5_TX UART5
PD2  UART5_RX UART5

# USART1 telemertry
PB6 USART1_TX USART1
PB7 USART1_RX USART1

# USART3 GPS2 / flexi
PB10 USART3_TX USART3 NODMA
PB11 USART3_RX USART3 NODMA

PC0 BATT_VOLTAGE_SENS ADC1
PC1 BATT_CURRENT_SENS ADC1 
PC2 PRESSURE_SENS ADC1 
PA2 RSSI_IN ADC1
PC3 VDD_5V_SENS ADC1 SCALE(2)


# order of I2C buses
I2C_ORDER I2C1 
PB8 I2C1_SCL I2C1 
PB9 I2C1_SDA I2C1 

#SPI1 internal
PA5 SPI1_SCK SPI1
PA6 SPI1_MISO SPI1
PA7 SPI1_MOSI SPI1

PB3 SPI3_SCK SPI3
PB4 SPI3_MISO SPI3
PB5 SPI3_MOSI SPI3

# radio DMA_CH ?
PA3 TIM5_CH4 TIM5 RCIN FLOAT LOW 
# sbus inverter 
PB2 SBUS_INV OUTPUT


# PWM out pins
PB14 TIM12_CH1 TIM12 PWM(1)
PB15 TIM12_CH2 TIM12 PWM(2)
PC6  TIM8_CH1   TIM8 PWM(3)
PC7  TIM8_CH2   TIM8 PWM(4)
PC8  TIM3_CH3   TIM3 PWM(5)
PC9  TIM3_CH4   TIM3 PWM(6)
PA8  TIM1_CH1   TIM1 PWM(7)
PA10 TIM1_CH3   TIM1 PWM(8)


# LED setup is similar to PixRacer LED_GREEN ?
define HAL_HAVE_PIXRACER_LED
PC13 LED_RED OUTPUT GPIO(10)
PC14 LED_BLUE OUTPUT GPIO(12)

define HAL_GPIO_A_LED_PIN 10
# define HAL_GPIO_B_LED_PIN 11
define HAL_GPIO_C_LED_PIN 12

define HAL_GPIO_LED_ON  0
define HAL_GPIO_LED_OFF 1


PA15 TIM2_CH1 TIM2 ALARM
# inverter control pin
PC15 INV_UART4 OUTPUT 

# SPI device table. The DEVID values are chosen to match the PX4 port
# of ArduPilot so users don't need to re-do their accel and compass calibrations
# when moving to ChibiOS
SPIDEV ms5611_int  SPI1 DEVID3  BARO_CS    MODE3  20*MHZ  20*MHZ
SPIDEV mpu9250     SPI1 DEVID4  MPU9250_CS MODE3   2*MHZ   4*MHZ
SPIDEV hmc5843     SPI1 DEVID5  MAG_CS     MODE3  11*MHZ  11*MHZ
# SPIDEV ramtron   SPI1 DEVID10 FRAM_CS    MODE3   8*MHZ   8*MHZ
SPIDEV dataflash   SPI3 DEVID1 FLASH_CS MODE3 1*MHZ 8*MHZ

PC5 BARO_CS CS 
PA4 MPU9250_CS CS 
PC4 MAG_CS CS
PC11 FRAM_CS CS 
PC10 FLASH_CS CS

PB0 MPU9250_DRDY INPUT PULLUP
PB1 DRDY_HMC5883 INPUT PULLUP

# PB12 CAN2_RX CAN2
# PB13 CAN2_TX CAN2

# todo define default compass, ins, baro 
define HAL_COMPASS_DEFAULT HAL_COMPASS_NONE
define HAL_INS_DEFAULT HAL_INS_NONE
define HAL_BARO_DEFAULT HAL_BARO_NONE

