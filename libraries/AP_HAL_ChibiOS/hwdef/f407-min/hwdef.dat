# hw definition file for processing by chibios_hwdef.py
# for minimal F407 based board

# MCU class and specific type
MCU STM32F4xx STM32F407xx
# is not declared chibios_hwdef.py for 407 
RAM_SIZE_KB 128
define def_ccm_size 64
define PORT_INT_REQUIRED_STACK 128
APJ_BOARD_ID 20
define CONFIG_HAL_BOARD_SUBTYPE HAL_BOARD_SUBTYPE_CHIBIOS_F4BY

# USB setup
USB_VENDOR 0x27AC # Swift-Flyer 
USB_PRODUCT 0x0201 # fmu usb driver 
USB_STRING_MANUFACTURER "Swift-Flyer"
USB_STRING_PRODUCT "%BOARD%"
USB_STRING_SERIAL  "%SERIAL%"

FLASH_SIZE_KB 1024

# crystal frequency
OSCILLATOR_HZ 8000000
STM32_PLLM_VALUE 8


# board voltage
STM32_VDD 330U

# order of UARTs (and USB)
UART_ORDER OTG1

PA11 OTG_FS_DM OTG1
PA12 OTG_FS_DP OTG1

PA13 JTMS-SWDIO SWD
PA14 JTCK-SWCLK SWD

define HAL_USE_EMPTY_STORAGE 1
define HAL_STORAGE_SIZE 16384

# define HAL_COMPASS_DEFAULT HAL_COMPASS_NONE
# define HAL_INS_DEFAULT HAL_INS_NONE
# define HAL_BARO_DEFAULT HAL_BARO_NONE



# enable FAT filesystem support (needs a microSD defined via SDIO)
define HAL_OS_FATFS_IO 1
define HAL_BOARD_LOG_DIRECTORY "/APM/LOGS"
define HAL_BOARD_TERRAIN_DIRECTORY "/APM/TERRAIN"
PC7 TIM8_CH2 TIM8 RCIN PULLUP LOW DMA_CH0 


#SPI1 for MPU
PA5 SPI1_SCK SPI1
PA6 SPI1_MISO SPI1
PA7 SPI1_MOSI SPI1
PA4 MPU_CS CS

PB12 OUTPUT HIGH
# spi bus for fram AND SD
PB13 SPI2_SCK SPI2
PB14 SPI2_MISO SPI2
PB15 SPI2_MOSI SPI2


define HAL_I2C_MAX_CLOCK 100000
I2C_ORDER I2C2 I2C1
PB8 I2C1_SCL I2C1 
PB9 I2C1_SDA I2C1 
PB10 I2C2_SCL I2C2
PB11 I2C2_SDA I2C2

define HAL_INS_DEFAULT HAL_INS_MPU60XX_SPI
define HAL_BARO_DEFAULT HAL_BARO_MS5611_I2C
define HAL_BARO_MS5611_I2C_BUS 0
define HAL_COMPASS_DEFAULT HAL_COMPASS_HMC5843
define HAL_COMPASS_HMC5843_I2C_BUS 0
define HAL_COMPASS_HMC5843_ROTATION ROTATION_YAW_270 

# define HAL_EXT_COMPASS_HMC5843_I2C_BUS 1
SPIDEV mpu6000   SPI1 DEVID1 MPU_CS   MODE3 1*MHZ 8*MHZ


